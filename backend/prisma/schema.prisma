generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Utilisateur {
  id        Int       @id @default(autoincrement())
  nom       String
  prenom    String?
  email     String?   @unique
  password  String
  role      Role      @default(GESTIONNAIRE)
  actif     Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  achats    Achat[]
  retours   Retour[]

  @@map("utilisateurs")
}

model Client {
  id        Int        @id @default(autoincrement())
  nom       String
  prenom    String?
  email     String?
  telephone String?
  adresse   String?
  type      TypeClient @default(SIMPLE)
  actif     Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  achats    Achat[]
  retours   Retour[]

  @@map("clients")
}

model Marque {
  id          Int       @id @default(autoincrement())
  nom         String    @unique
  image       String?
  description String?
  versment    Float     @default(0)
  credit      Float     @default(0)
  actif       Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  produits    Produit[]

  @@map("marques")
}

model Categorie {
  id          Int       @id @default(autoincrement())
  nom         String    @unique
  description String?
  actif       Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  image       String?
  produits    Produit[]

  @@map("categories")
}

model Produit {
  id             Int           @id @default(autoincrement())
  reference      String        @unique
  nom            String
  description    String?
  image          String?
  modeVente      ModeVente     @default(TOTAL)
  prixTotal      Float?
  prixPartiel    Float?
  uniteMesure    UniteMesure?
  poids          Float?
  quantite_stock Float         @default(0)
  seuilAlerte    Float         @default(5)
  actif          Boolean       @default(true)
  deleted        Boolean       @default(false)
  marqueId       Int
  categorieId    Int
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  perissable     Boolean       @default(false)
  ligneAchats    LigneAchat[]
  ligneRetours   LigneRetour[]
  lot_de_stock   LotDeStock[]
  categorie      Categorie     @relation(fields: [categorieId], references: [id])
  marque         Marque        @relation(fields: [marqueId], references: [id])

  @@map("produits")
}

model LotDeStock {
  id              Int       @id @default(autoincrement())
  produitId       Int
  quantite        Float
  quantite_restante Float  @default(0)
  date_expiration DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  produit         Produit   @relation(fields: [produitId], references: [id])

  @@map("lots_de_stock")
}

model Achat {
  id                Int          @id @default(autoincrement())
  numeroBon         String       @unique
  clientId          Int
  utilisateurId     Int
  prix_total        Float
  remiseGlobale     Float        @default(0)
  prix_total_remise Float
  statut            Statut       @default(VALIDE)
  dateAchat         DateTime     @default(now())
  notes             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  versment          Float        @default(0)
  client            Client       @relation(fields: [clientId], references: [id])
  utilisateur       Utilisateur  @relation(fields: [utilisateurId], references: [id])
  ligneAchats       LigneAchat[]
  retours           Retour[]

  @@map("achats")
}

model LigneAchat {
  id                Int           @id @default(autoincrement())
  achatId           Int
  produitId         Int
  quantite          Float
  quantiteRetournee Float         @default(0)
  prixUnitaire      Float
  remise            Float         @default(0)
  sousTotal         Float
  createdAt         DateTime      @default(now())
  achat             Achat         @relation(fields: [achatId], references: [id], onDelete: Cascade)
  produit           Produit       @relation(fields: [produitId], references: [id])
  ligneRetours      LigneRetour[]

  @@map("lignes_achats")
}

model Retour {
  id               Int           @id @default(autoincrement())
  numeroRetour     String        @unique
  achatId          Int
  clientId         Int
  utilisateurId    Int
  montantRembourse Float
  typeRetour       TypeRetour
  motif            String?
  dateRetour       DateTime      @default(now())
  createdAt        DateTime      @default(now())
  ligneRetours     LigneRetour[]
  achat            Achat         @relation(fields: [achatId], references: [id])
  client           Client        @relation(fields: [clientId], references: [id])
  utilisateur      Utilisateur   @relation(fields: [utilisateurId], references: [id])

  @@map("retours")
}

model LigneRetour {
  id                Int        @id @default(autoincrement())
  retourId          Int
  ligneAchatId      Int
  produitId         Int
  quantiteRetournee Float
  montantLigne      Float
  motifDetaille     String?
  createdAt         DateTime   @default(now())
  ligneAchat        LigneAchat @relation(fields: [ligneAchatId], references: [id])
  produit           Produit    @relation(fields: [produitId], references: [id])
  retour            Retour     @relation(fields: [retourId], references: [id], onDelete: Cascade)

  @@map("lignes_retours")
}

enum Role {
  GESTIONNAIRE
  ADMIN
}

enum TypeClient {
  SIMPLE
  PEINTRE
}

enum UniteMesure {
  PIECE
  KG
  LITRE
  METRE
}

enum ModeVente {
  TOTAL
  PARTIAL
  BOTH
}

enum Statut {
  VALIDE
  RETOURNE_PARTIEL
  RETOURNE_TOTAL
}

enum TypeRetour {
  PARTIEL
  TOTAL
}
